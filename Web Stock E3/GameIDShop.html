<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game ID Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Replace the mock data section and enable the fetch code -->
<script>
   document.addEventListener("DOMContentLoaded", function () {
    const gameIdContainer = document.getElementById("gameIdContainer");
    const noGameId = document.getElementById("noGameId");
    const errorMessage = document.createElement("p");
    errorMessage.className = "mt-4 text-red-500 text-center";
    errorMessage.id = "errorMessage";
    errorMessage.style.display = "none";

    // ตรวจสอบว่า user login หรือไม่
    const username = localStorage.getItem("username");
    if (!username) {
        window.location.href = "Login.html";
        return;
    }

    // ดึงข้อมูลไอดีเกมจาก API
    fetch("get_game_ids.php")
        .then(response => {
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            console.log("API Response:", data); // ตรวจสอบข้อมูลที่ได้จาก PHP
            displayGameIds(data);
        })
        .catch(error => {
            console.error("Error fetching game IDs:", error);
            errorMessage.textContent = "เกิดข้อผิดพลาดในการโหลดไอดีเกม กรุณาลองใหม่อีกครั้ง!";
            errorMessage.style.display = "block";
            gameIdContainer.innerHTML = "";
            noGameId.classList.remove("hidden");
        });

    function displayGameIds(data) {
        console.log("Game IDs:", data.gameIds); // ตรวจสอบว่ามีข้อมูลจริงไหม

        if (!data.success || !data.gameIds || data.gameIds.length === 0) {
            errorMessage.textContent = data.message || "ไม่มีไอดีเกมที่พร้อมขาย!";
            errorMessage.style.display = "block";
            gameIdContainer.innerHTML = "";
            noGameId.classList.remove("hidden");
            return;
        }

        gameIdContainer.innerHTML = "";

        // แยกประเภทเกม (สามารถเพิ่ม category ได้)
        const categorizedGameIds = data.gameIds.reduce((acc, game) => {
            const category = game.game_id || "Uncategorized";
            if (!acc[category]) acc[category] = [];
            acc[category].push(game);
            return acc;
        }, {});

        // สร้างการ์ดสำหรับแต่ละประเภท
        for (const [category, games] of Object.entries(categorizedGameIds)) {
            const categorySection = document.createElement("div");
            categorySection.className = "mb-10";

            categorySection.innerHTML = `
                <div class="category-header">
                    <h3 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200 relative inline-block">
                        ${category} Games
                        <span class="absolute bottom-0 left-0 w-full h-1 bg-purple-500 rounded"></span>
                    </h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    ${games.map(game => `
                        <div class="game-card ${game.status === 'available' ? '' : 'sold'}" data-id="${game.account_id}">
                            <div class="game-card-inner">
                                <div class="game-card-front">
                                    <div class="card-content">
                                        <h4 class="text-xl font-bold mb-2">#${game.account_id}</h4>
                                        <div class="status-badge ${game.status === 'available' ? 'bg-green-500' : 'bg-red-500'}">
                                            ${game.status === 'available' ? 'Available' : 'Sold'}
                                        </div>
                                        <p class="text-lg font-semibold mt-3">${game.price} บาท</p>
                                    </div>
                                </div>
                                <div class="game-card-back">
                                    <div class="card-content">
                                        <h4 class="text-lg font-bold mb-2">Game ID Details</h4>
                                        <p class="mb-1"><span class="font-medium">Username:</span> ${game.username}</p>
                                        <p class="mb-1"><span class="font-medium">Details:</span> ${game.details}</p>
                                        <p class="mb-3"><span class="font-medium">Status:</span> ${game.status}</p>
                                        ${game.status === 'available' ? 
                                            `<button class="buy-btn" data-id="${game.account_id}">Buy Now</button>` : 
                                            `<p class="sold-text">Already Sold</p>`
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            gameIdContainer.appendChild(categorySection);
        }

        // ซ่อนข้อความเมื่อมีข้อมูล
        noGameId.classList.add("hidden");
        errorMessage.style.display = "none";

        // เพิ่ม event listener ให้การ์ดสามารถพลิกได้
        document.querySelectorAll('.game-card').forEach(card => {
            card.addEventListener('click', function(e) {
                if (!e.target.classList.contains('buy-btn')) {
                    this.classList.toggle('flipped');
                }
            });

            const buyBtn = card.querySelector('.buy-btn');
            if (buyBtn) {
                buyBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const gameId = this.getAttribute('data-id');
                    purchaseGame(gameId, card);
                });
            }
        });
    }

    // ฟังก์ชันซื้อไอดีเกม
    function purchaseGame(gameId, cardElement) {
        fetch('buy_game.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ account_id: gameId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // อัปเดตสถานะของการ์ด
                cardElement.classList.add('sold');
                const statusBadge = cardElement.querySelector('.status-badge');
                statusBadge.textContent = 'Sold';
                statusBadge.classList.remove('bg-green-500');
                statusBadge.classList.add('bg-red-500');

                const buyBtn = cardElement.querySelector('.buy-btn');
                buyBtn.outerHTML = '<p class="sold-text">Already Sold</p>';

                alert('การซื้อสำเร็จ!');
            } else {
                alert(data.message || 'การซื้อไม่สำเร็จ กรุณาลองใหม่!');
            }
        })
        .catch(error => {
            console.error('Purchase error:', error);
            alert('เกิดข้อผิดพลาดในการซื้อ กรุณาลองใหม่!');
        });
    }

    document.querySelector("main").appendChild(errorMessage);

    // ฟังก์ชันออกจากระบบ
    function logout() {
        localStorage.removeItem("username");
        window.location.href = "Login.html";
    }

    // ฟังก์ชันเปลี่ยนธีม
    function toggleTheme() {
        const isDarkMode = document.documentElement.classList.toggle("dark");
        
        if (isDarkMode) {
            applyDarkMode();
            localStorage.setItem("theme", "dark");
        } else {
            applyLightMode();
            localStorage.setItem("theme", "light");
        }
    }

    function applyDarkMode() {
        document.getElementById("logo").src = "image/logo_player/dark_logo.png";
        document.querySelectorAll('.game-card').forEach(card => {
            card.classList.add('dark-card');
        });
    }

    function applyLightMode() {
        document.getElementById("logo").src = "image/logo_player/light_logo.png";
        document.querySelectorAll('.game-card').forEach(card => {
            card.classList.remove('dark-card');
        });
    }
});

    </script>
    <style>
        /* Base Styles */
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        
        /* Theme Variables */
        :root {
            --bg-color: #f3f4f6;
            --text-color: #1f2937;
            --navbar-bg: #6b46c1;
            --navbar-text: #ffffff;
            --card-bg: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --card-highlight: rgba(107, 70, 193, 0.2);
            --badge-available: #10b981;
            --badge-sold: #ef4444;
            --btn-primary: #6b46c1;
            --btn-hover: #5a32a3;
        }
        
        .dark {
            --bg-color: #1a1f36;
            --text-color: #e5e7eb;
            --navbar-bg: #10142b;
            --navbar-text: #00ffff;
            --card-bg: #232c58;
            --card-shadow: rgba(0, 0, 0, 0.4);
            --card-highlight: rgba(0, 255, 255, 0.1);
            --badge-available: #059669;
            --badge-sold: #dc2626;
            --btn-primary: #4f46e5;
            --btn-hover: #4338ca;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Header Styles */
        header {
            background: var(--navbar-bg);
            color: var(--navbar-text);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background 0.3s, color 0.3s;
        }
        
        .dark header {
            text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
            background: linear-gradient(to right, #070f1f, #0c1326);
        }
        
        /* 3D Card Styles */
        .game-card {
            perspective: 1000px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }
        
        .game-card:hover {
            transform: translateY(-10px);
        }
        
        .game-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px var(--card-shadow);
            border-radius: 1rem;
        }
        
        .game-card.flipped .game-card-inner {
            transform: rotateY(180deg);
        }
        
        .game-card-front, .game-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            text-align: center;
            box-shadow: 0 10px 15px -3px var(--card-shadow);
        }
        
        .game-card-front {
            background: linear-gradient(145deg, var(--card-bg), var(--card-highlight));
        }
        
        .game-card-back {
            transform: rotateY(180deg);
            background: linear-gradient(145deg, var(--card-highlight), var(--card-bg));
        }
        
        .card-content {
            width: 100%;
        }
        
        .status-badge {
            display: inline-block;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .buy-btn {
            background-color: var(--btn-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .buy-btn:hover {
            background-color: var(--btn-hover);
        }
        
        .sold-text {
            color: var(--badge-sold);
            font-weight: 600;
        }
        
        .game-card.sold .game-card-front {
            opacity: 0.7;
        }
        
        /* Category Header */
        .category-header {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        /* Dark Mode Card */
        .dark-card .game-card-front, .dark-card .game-card-back {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        
        /* Main Container */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        /* Responsive Nav */
        .nav-menu {
            display: flex;
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .nav-menu {
                gap: 0.75rem;
                font-size: 0.875rem;
            }
            
            .game-card {
                height: 180px;
            }
        }
        
        /* Animation for cards */
        @keyframes cardPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .game-card:hover .game-card-inner {
            animation: cardPulse 1.5s infinite;
        }
    </style>
</head>

<body>
    <header>
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold inline">
                <img
                    id="logo"
                    src="image/logo_player/light_logo.png"
                    alt="PLAYERHAVEN Logo"
                    class="w-auto h-16 inline mr-3 transition-transform duration-300 hover:scale-105"
                />
                PLAYERHAVEN
            </div>
            
            <nav class="nav-menu">
                <a href="HomePage.html" class="hover:text-indigo-300">หน้าแรก</a>
                <a href="#" class="hover:text-indigo-300">ไอดีเกมออนไลน์</a>
                <a href="#" class="hover:text-indigo-300">สุ่มไอดีเกม</a>
                <a href="#" class="hover:text-indigo-300">บัตรเติมเกม</a>
                <a href="HomePage.html" class="hover:text-indigo-300">เติมเกมออนไลน์</a>
                <a href="#" class="hover:text-indigo-300">ติดต่อเรา</a>
            </nav>
            
            <div class="flex items-center space-x-4">
                <button id="logoutBtn" class="bg-red-500 px-3 py-1.5 rounded hover:bg-red-600 text-white text-sm"
                    onclick="logout()">
                    ออกจากระบบ
                </button>
                
                <button onclick="toggleTheme()" class="p-2 rounded bg-gray-300 dark:bg-gray-600 text-lg">
                    🌙 / ☀️
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-6 mb-8 text-white">
            <h1 class="text-3xl font-bold mb-2">ระบบขายไอดีเกม</h1>
            <p class="text-lg">เลือกไอดีเกมที่ต้องการ คลิกที่การ์ดเพื่อดูรายละเอียดเพิ่มเติม</p>
        </div>
        
        <!-- Game Filters -->
        <div class="flex flex-wrap gap-3 mb-6">
            <button class="px-4 py-2 bg-purple-600 text-white rounded-full hover:bg-purple-700">ทั้งหมด</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">Action</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">RPG</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">MOBA</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">FPS</button>
        </div>
        
        <!-- Game Cards Container -->
        <div id="gameIdContainer" class="space-y-8"></div>
        
        <!-- No Game ID Message -->
        <p id="noGameId" class="mt-8 text-xl text-center text-gray-500 dark:text-gray-400 hidden">
            ไม่มีไอดีเกมที่ว่างอยู่ในขณะนี้ กรุณาตรวจสอบอีกครั้งในภายหลัง
        </p>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>© 2025 PLAYERHAVEN - ศูนย์กลางเกมออนไลน์ที่ครบวงจร</p>
            <div class="flex justify-center mt-4 space-x-4">
                <a href="#" class="hover:text-purple-400">เงื่อนไขการใช้บริการ</a>
                <a href="#" class="hover:text-purple-400">นโยบายความเป็นส่วนตัว</a>
                <a href="#" class="hover:text-purple-400">คำถามที่พบบ่อย</a>
            </div>
        </div>
    </footer>
</body>
</html>